<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Tools – Decode from screenshots (auto link)</title>
  <meta name="description" content="Free QR tools: instantly extract links from QR codes in screenshots or uploads. Auto-redirect in the same tab. Minimal, fast, privacy-friendly.">
  <link rel="canonical" href="https://example.com/qr-tools" />
  <meta property="og:title" content="QR Tools – Decode from screenshots (auto link)">
  <meta property="og:description" content="Instantly extract links from QR codes in screenshots. Auto open without a new tab.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://example.com/qr-tools">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "QR Tools",
    "url": "https://example.com/qr-tools",
    "applicationCategory": "UtilitiesApplication",
    "operatingSystem": "Web",
    "offers": {"@type": "Offer", "price": "0"}
  }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://unpkg.com/@zxing/browser@1.0.2/umd/index.min.js"></script>
  <style>html{scroll-behavior:smooth}</style>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- Consent (simple placeholder). Replace with a real CMP for production. -->
  <div id="cookie-banner" class="hidden fixed inset-x-0 bottom-0 z-50 bg-white/90 backdrop-blur border-t border-slate-200">
    <div class="max-w-6xl mx-auto p-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <p class="text-sm">We use cookies for core features and (if you agree) ads/analytics. <a href="#" class="underline">Learn more</a></p>
      <div class="flex gap-2">
        <button id="btn-decline" class="px-3 py-1.5 rounded-xl border">Decline</button>
        <button id="btn-accept" class="px-3 py-1.5 rounded-xl bg-slate-900 text-white">Accept all</button>
      </div>
    </div>
  </div>

  <header class="border-b border-slate-200 bg-white sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-slate-900"></div>
        <h1 class="text-xl font-bold">QR Tools</h1>
      </div>
      <nav class="hidden sm:flex gap-6 text-sm">
        <a href="#decoder" class="hover:underline">Decode</a>
        <a href="#generator" class="hover:underline">Create</a>
        <a href="#faq" class="hover:underline">FAQ</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-10">
    <section class="mb-10">
      <div class="grid lg:grid-cols-[1fr,320px] gap-8 items-start">
        <div class="text-center lg:text-left">
          <h2 class="text-3xl sm:text-4xl font-extrabold tracking-tight">Instant QR decode from screenshots</h2>
          <p class="mt-3 text-slate-600">Paste <span class="font-semibold">(Ctrl/Cmd+V)</span>, drag & drop, or upload. We auto-open the detected link in the <span class="font-semibold">same tab</span> — no extra click, no new tab.</p>
          <!-- AD SLOT HERO -->
          <div id="ad-hero" class="mt-6 rounded-2xl border border-dashed border-slate-300 p-6 text-slate-500 text-center">Ad (responsive)</div>
        </div>
        <aside class="hidden lg:flex lg:flex-col gap-6">
          <div id="ad-side-1" class="rounded-2xl border border-dashed border-slate-300 p-6 text-slate-500 text-center min-h-[250px]">Ad (sidebar)</div>
          <div id="ad-side-2" class="rounded-2xl border border-dashed border-slate-300 p-6 text-slate-500 text-center min-h-[600px]">Ad (sidebar tall)</div>
        </aside>
      </div>
    </section>

    <div class="grid lg:grid-cols-[1fr,320px] gap-8 items-start">
      <div class="space-y-8">
        <!-- Decoder (primary) -->
        <section id="decoder" class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
          <h3 class="text-lg font-semibold">QR Code → Link/Text (auto)</h3>
          <p class="text-sm text-slate-600 mt-1">Upload, drag & drop, or paste an image (perfect for YouTube screenshots). As soon as a QR is detected, we redirect in the same tab.</p>

          <div class="mt-4 grid sm:grid-cols-2 gap-3">
            <div>
              <label class="text-sm">Upload image</label>
              <input id="file-input" type="file" accept="image/*" class="mt-1 w-full rounded-xl border p-2" />
            </div>
            <div class="flex items-end gap-2">
              <button id="btn-start-camera" class="flex-1 h-10 rounded-xl border">Start camera</button>
              <button id="btn-stop-camera" class="h-10 rounded-xl border">Stop</button>
            </div>
          </div>

          <div id="dropzone" class="mt-4 w-full rounded-2xl border-2 border-dashed border-slate-300 p-6 text-center text-slate-500">
            Drop screenshot here or <span class="underline">paste (Ctrl/Cmd+V)</span>
          </div>

          <video id="video" class="mt-4 w-full rounded-2xl bg-slate-100" playsinline></video>

          <div class="mt-4">
            <label class="text-sm">Result</label>
            <textarea id="decode-result" class="mt-1 w-full rounded-xl border-slate-300 p-3" rows="3" readonly></textarea>
            <div class="mt-2 flex flex-wrap gap-3 items-center">
              <button id="copy-result" class="px-3 py-1.5 rounded-xl border">Copy</button>
              <label class="flex items-center gap-2 text-sm text-slate-600"><input id="auto-redirect" type="checkbox" class="rounded" checked> Auto redirect (same tab)</label>
            </div>
            <p class="mt-3 text-xs text-slate-500">Tips: Pause at 1080p+, capture a sharp frame, crop around the QR if it’s tiny.</p>
          </div>
        </section>

        <!-- Inline ad between tools -->
        <div id="ad-infeed-1" class="rounded-2xl border border-dashed border-slate-300 p-6 text-slate-500 text-center">Ad (in-feed)</div>

        <!-- Generator (secondary, still useful) -->
        <section id="generator" class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
          <h3 class="text-lg font-semibold">Link → QR Code</h3>
          <p class="text-sm text-slate-600 mt-1">Enter text/URL and download as PNG.</p>

          <label for="qr-text" class="block mt-4 text-sm font-medium">Text/URL</label>
          <textarea id="qr-text" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900 p-3" rows="3" placeholder="https://your-link.tld"></textarea>

          <div class="mt-4 grid sm:grid-cols-3 gap-3 items-end">
            <div>
              <label class="text-sm">Size (px)</label>
              <input id="qr-size" type="number" value="256" min="128" max="1024" class="mt-1 w-full rounded-xl border-slate-300 p-2">
            </div>
            <div>
              <label class="text-sm">Error correction</label>
              <select id="qr-ecc" class="mt-1 w-full rounded-xl border-slate-300 p-2">
                <option value="L">L (7%)</option>
                <option value="M" selected>M (15%)</option>
                <option value="Q">Q (25%)</option>
                <option value="H">H (30%)</option>
              </select>
            </div>
            <button id="btn-generate" class="h-10 rounded-xl bg-slate-900 text-white">Generate</button>
          </div>

          <div class="mt-6 flex flex-col sm:flex-row gap-6 sm:items-center">
            <div id="qrcode" class="rounded-2xl bg-slate-100 p-4 w-[min(100%,320px)]"></div>
            <div class="flex gap-3">
              <button id="btn-download" class="px-4 py-2 rounded-xl border">Save PNG</button>
              <button id="btn-clear" class="px-4 py-2 rounded-xl border">Reset</button>
            </div>
          </div>
        </section>

        <div id="ad-infeed-2" class="rounded-2xl border border-dashed border-slate-300 p-6 text-slate-500 text-center">Ad (in-feed)</div>

        <section id="faq" class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
          <h3 class="text-lg font-semibold">FAQ</h3>
          <details class="mt-3">
            <summary class="font-medium cursor-pointer">Do you upload my images?</summary>
            <p class="mt-2 text-sm text-slate-600">No. All decoding/generation happens locally in your browser. Camera permission is required, but video never leaves your device.</p>
          </details>
          <details class="mt-3">
            <summary class="font-medium cursor-pointer">Is it privacy friendly?</summary>
            <p class="mt-2 text-sm text-slate-600">Yes. Use a real consent banner before enabling any analytics/ads scripts.</p>
          </details>
          <details class="mt-3">
            <summary class="font-medium cursor-pointer">Commercial use?</summary>
            <p class="mt-2 text-sm text-slate-600">Yes. Sell ads (see slots on this page) or add premium features later (dynamic QR, stats, branding).</p>
          </details>
        </section>

        <div id="ad-infeed-3" class="rounded-2xl border border-dashed border-slate-300 p-6 text-slate-500 text-center">Ad (in-feed)</div>
      </div>

      <!-- Right column (on large screens): extra ads already placed above -->
      <aside class="hidden lg:block"></aside>
    </div>

    <!-- Sticky bottom banner -->
    <div id="ad-sticky" class="fixed inset-x-4 bottom-4 z-40 rounded-2xl border border-dashed border-slate-300 bg-white/95 p-4 text-slate-500 text-center shadow-lg">
      Ad (sticky)
      <button id="hide-sticky" class="ml-3 text-xs underline">hide</button>
    </div>
  </main>

  <footer class="border-t border-slate-200 py-10 text-sm">
    <div class="max-w-6xl mx-auto px-4 flex flex-col sm:flex-row items-center justify-between gap-4">
      <p>© <span id="year"></span> QR Tools</p>
      <div class="flex gap-4">
        <a href="#" class="hover:underline">Imprint</a>
        <a href="#" class="hover:underline">Privacy</a>
      </div>
    </div>
  </footer>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Sticky hide
    document.getElementById('hide-sticky')?.addEventListener('click', () => document.getElementById('ad-sticky')?.remove());

    // Consent placeholder
    const banner = document.getElementById('cookie-banner');
    const accept = document.getElementById('btn-accept');
    const decline = document.getElementById('btn-decline');
    const consentKey = 'qrtools-consent';
    if (!localStorage.getItem(consentKey)) banner.classList.remove('hidden');
    accept?.addEventListener('click', () => { localStorage.setItem(consentKey, 'all'); banner.classList.add('hidden'); loadAds(); });
    decline?.addEventListener('click', () => { localStorage.setItem(consentKey, 'essential'); banner.classList.add('hidden'); });
    if (localStorage.getItem(consentKey) === 'all') { loadAds(); }

    // ----------- QR GENERATOR -----------
    let qr;
    const qrcodeEl = document.getElementById('qrcode');
    const textEl = document.getElementById('qr-text');
    const sizeEl = document.getElementById('qr-size');
    const eccEl = document.getElementById('qr-ecc');

    function generate() {
      if(!qrcodeEl) return;
      qrcodeEl.innerHTML = '';
      const size = Math.max(128, Math.min(1024, parseInt(sizeEl?.value || '256', 10)));
      qr = new QRCode(qrcodeEl, {
        text: textEl?.value || 'https://example.com',
        width: size,
        height: size,
        correctLevel: QRCode.CorrectLevel[eccEl?.value || 'M']
      });
    }

    document.getElementById('btn-generate')?.addEventListener('click', generate);
    document.getElementById('btn-clear')?.addEventListener('click', () => { if(qrcodeEl) qrcodeEl.innerHTML = ''; if(textEl) textEl.value=''; });
    document.getElementById('btn-download')?.addEventListener('click', () => {
      const img = qrcodeEl?.querySelector('img') || qrcodeEl?.querySelector('canvas');
      if (!img) return;
      const link = document.createElement('a');
      link.download = 'qr-code.png';
      link.href = img.src || img.toDataURL('image/png');
      link.click();
    });

    // ----------- QR DECODER (auto, same-tab) -----------
    const { BrowserQRCodeReader } = ZXingBrowser;
    const codeReader = new BrowserQRCodeReader();
    const video = document.getElementById('video');
    const fileInput = document.getElementById('file-input');
    const dropzone = document.getElementById('dropzone');
    const resultEl = document.getElementById('decode-result');
    const copyBtn = document.getElementById('copy-result');
    const autoRedirect = document.getElementById('auto-redirect');

    async function preprocessFileToObjectURL(file) {
      const img = await createImageBitmap(file);
      const maxDim = 1600;
      const scale = Math.min(1, maxDim / Math.max(img.width, img.height));
      const canvas = document.createElement('canvas');
      canvas.width = Math.round(img.width * scale);
      canvas.height = Math.round(img.height * scale);
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      // grayscale + simple threshold
      let sum = 0;
      for (let i = 0; i < imgData.data.length; i += 4) {
        const r = imgData.data[i], g = imgData.data[i+1], b = imgData.data[i+2];
        const y = (r*299 + g*587 + b*114) / 1000;
        imgData.data[i] = imgData.data[i+1] = imgData.data[i+2] = y;
        sum += y;
      }
      const mean = sum / (imgData.data.length / 4);
      const t = Math.max(64, Math.min(192, mean));
      for (let i = 0; i < imgData.data.length; i += 4) {
        const y = imgData.data[i];
        const v = y > t ? 255 : 0;
        imgData.data[i] = imgData.data[i+1] = imgData.data[i+2] = v;
      }
      ctx.putImageData(imgData, 0, 0);
      return await new Promise(res => canvas.toBlob(b => res(URL.createObjectURL(b)), 'image/png'));
    }

    async function decodeFromFile(file) {
      let tmpUrl;
      try {
        tmpUrl = await preprocessFileToObjectURL(file);
        const res = await codeReader.decodeFromImageUrl(tmpUrl);
        handleResult(res.getText());
      } catch (err) {
        try {
          const fallbackUrl = URL.createObjectURL(file);
          const res2 = await codeReader.decodeFromImageUrl(fallbackUrl);
          handleResult(res2.getText());
          URL.revokeObjectURL(fallbackUrl);
        } catch (e2) {
          handleResult('No QR code found.');
          console.error(e2);
        }
      } finally {
        if (tmpUrl) URL.revokeObjectURL(tmpUrl);
      }
    }

    function normalizeToUrl(text) {
      if (!text) return '';
      if (/^www\./i.test(text)) return 'https://' + text; // add protocol if missing
      return text;
    }

    function handleResult(text) {
      const cleaned = (text || '').trim();
      if (resultEl) resultEl.value = cleaned;
      let urlCandidate = '';
      try {
        urlCandidate = normalizeToUrl(cleaned);
        const url = new URL(urlCandidate);
        if (autoRedirect?.checked) {
          // same-tab navigation (no new window)
          window.location.assign(url.toString());
        }
      } catch {
        // not a valid URL – just keep the text in the box
      }
    }

    // File input
    fileInput?.addEventListener('change', async (e) => {
      const file = e.target.files?.[0];
      if (file) await decodeFromFile(file);
    });

    // Drag & drop
    ['dragenter','dragover'].forEach(evt => dropzone?.addEventListener(evt, (e) => { e.preventDefault(); dropzone.classList.add('border-slate-500'); }));
    ;['dragleave','drop'].forEach(evt => dropzone?.addEventListener(evt, (e) => { e.preventDefault(); dropzone.classList.remove('border-slate-500'); }));
    dropzone?.addEventListener('drop', async (e) => {
      const file = e.dataTransfer.files?.[0];
      if (file) await decodeFromFile(file);
    });

    // Paste from clipboard
    window.addEventListener('paste', async (e) => {
      const item = [...(e.clipboardData?.items||[])].find(i => i.type.startsWith('image/'));
      if (item) {
        const file = item.getAsFile();
        if (file) await decodeFromFile(file);
      }
    });

    // Camera live decode (does not auto-redirect to avoid flickering). You can enable if desired.
    document.getElementById('btn-start-camera')?.addEventListener('click', async () => {
      try {
        const devices = await BrowserQRCodeReader.listVideoInputDevices();
        const deviceId = devices?.[0]?.deviceId;
        if (!deviceId) throw new Error('No camera found');
        await codeReader.decodeFromVideoDevice(deviceId, video, (result) => {
          if (result) handleResult(result.getText());
        });
      } catch (e) { alert(e.message || e); }
    });

    document.getElementById('btn-stop-camera')?.addEventListener('click', async () => {
      try { await codeReader.reset(); } catch {}
      if (video?.srcObject) {
        const tracks = video.srcObject.getTracks();
        tracks.forEach(t => t.stop());
        video.srcObject = null;
      }
    });

    // ----------- ADSENSE LOADING (after consent) -----------
    function loadAds() {
      const ADS_CLIENT = 'ca-pub-XXXX'; // TODO: your publisher ID
      if (!ADS_CLIENT || ADS_CLIENT.includes('XXXX')) return; // safety: don't load without real ID

      const s = document.createElement('script');
      s.async = true; s.crossOrigin = 'anonymous';
      s.src = `https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${ADS_CLIENT}`;
      document.head.appendChild(s);

      function fill(el, slot, format='auto', fullWidth=true){
        if(!el) return;
        const ins = document.createElement('ins');
        ins.className = 'adsbygoogle'; ins.style.display = 'block';
        ins.setAttribute('data-ad-client', ADS_CLIENT);
        if(slot) ins.setAttribute('data-ad-slot', slot);
        ins.setAttribute('data-ad-format', format);
        if(fullWidth) ins.setAttribute('data-full-width-responsive','true');
        el.innerHTML = ''; el.appendChild(ins);
        (window.adsbygoogle = window.adsbygoogle || []).push({});
      }

      // TODO: replace with your slot IDs
      const slots = {
        hero: 'SLOT_HERO', side1: 'SLOT_SIDE1', side2: 'SLOT_SIDE2',
        in1: 'SLOT_IN1', in2: 'SLOT_IN2', in3: 'SLOT_IN3', sticky: 'SLOT_STICKY'
      };

      fill(document.getElementById('ad-hero'), slots.hero);
      fill(document.getElementById('ad-side-1'), slots.side1);
      fill(document.getElementById('ad-side-2'), slots.side2);
      fill(document.getElementById('ad-infeed-1'), slots.in1);
      fill(document.getElementById('ad-infeed-2'), slots.in2);
      fill(document.getElementById('ad-infeed-3'), slots.in3);
      fill(document.getElementById('ad-sticky'), slots.sticky);
    }
  </script>
</body>
</html>
